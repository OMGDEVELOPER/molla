{% schema %}
{
  "name": "Installers",
  "tag": "section",
  "class": "installers-section",
  "settings": [
    {
      "type": "metaobject_list",
      "metaobject_type": "installers",
      "id": "installers_list",
      "label": "Select Installers"
    }
  ],
  "presets": [
    {
      "name": "Installers",
      "category": "Metaobjects"
    }
  ]
}
{% endschema %}

{{ 'installers.css' | asset_url | stylesheet_tag }}
{{ 'https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css' | stylesheet_tag }}
<script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>

<div class="grid grid-cols-3 container">
  {% for item in section.settings.installers_list %}
    <div class="item">
      <div class="featured-img">
        {{ item.featured_image | image_url: width: item.featured_image.width | image_tag: alt: item.featured_image.alt }}
      </div>
      <div class="installer-details">
        <div class="title">{{ item.title }}</div>
        <div class="cta">
          <button class="open-modal">View Details</button>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<!-- Modal -->
<div id="installer-modal" class="installer-modal hidden">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <button class="modal-close">&times;</button>
    <div id="installer-splide" class="splide">
      <div class="splide__track">
        <ul class="splide__list">
          {% for item in section.settings.installers_list %}
            <li class="splide__slide">
              <div class="modal-slide-content">
                {{ item.featured_image | image_url: width: 800 | image_tag: alt: item.featured_image.alt }}
                <h3>{{ item.title }}</h3>
                <p>{{ item.description }}</p>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const modal = document.getElementById('installer-modal');
  const closeBtn = modal.querySelector('.modal-close');
  const overlay = modal.querySelector('.modal-overlay');
  let splide;

  // Open modal on button click
  document.querySelectorAll('.open-modal').forEach((btn, index) => {
    btn.addEventListener('click', function () {
      modal.classList.remove('hidden');

      // Init or re-init Splide
      if (splide) splide.destroy();
      splide = new Splide('#installer-splide', {
        type: 'loop',
        perPage: 1,
        pagination: true,
        arrows: true,
        start: index, // open at clicked item
      }).mount();
    });
  });

  // Close modal
  [closeBtn, overlay].forEach(el =>
    el.addEventListener('click', () => modal.classList.add('hidden'))
  );
});
</script>