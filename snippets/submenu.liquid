{% style %}
  .submenu__items,
  .submenu-subitems {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .submenu__items > li,
  .submenu-subitems > li {
    /* position: relative; */
  }

  .submenu-subitems,
  .style-2,
  .submenu-subitems-inner {
    /* display: none; */
    position: absolute;
    top: 0;
    left: 100%;
    background: white;
    padding: 1rem;
    min-width: 220px;
    z-index: 10;
  }

  .submenu__items > li:hover > .style-2,
  .style-2 .submenu__items > li:hover > .submenu-subitems {
    /* display: block; */
  }

  .submenu-subitems-inner {
    left: 100%;
    top: 0;
  }

  /* Add transition for smoothness */
  .style-2,
  .submenu-subitems,
  .submenu-subitems-inner {
    transition: opacity 0.2s ease, visibility 0.2s ease;
  }
  .uppercase{
    text-transform:uppercase;
  }

{% endstyle %}
<submenu>
  <div class="submenu submenu-container container {{ block.id }}" id="{{ block.id }}">
    <div class="row">
                <div class="col-12 col-md-3 item item__1">
            <div class="item__1__group">
              <div class="submenu__heading">
                  <h3>OUR PRODUCTS</h3>
              </div>
              <ul class="submenu__items">
                   <li target-id="{{ block.settings.item-1-label }}" submenu-items="{{ block.settings.menu-item-1 }}"><a href="#">{{ block.settings.item-1-label }}</a></li>
                  <li target-id="{{ block.settings.item-2-label }}"><a href="#">{{ block.settings.item-2-label }}</a></li>
            
              </ul>
            </div>
            <ul class="submenu__items links-with-icon">
              <li><a href="#"><span class="__icon"><img src="https://cdn.shopify.com/s/files/1/0859/1186/3592/files/sell.svg?v=1752660278" alt="icon"></span><span class="__label">Special Offers</span></a></li>
              <li><a href="#"><span class="__icon"><img src="https://cdn.shopify.com/s/files/1/0859/1186/3592/files/sell.svg?v=1752660278" alt="icon"></span><span class="__label">Special Offers</span></a></li>
              <li><a href="#"><span class="__icon"><img src="https://cdn.shopify.com/s/files/1/0859/1186/3592/files/sell.svg?v=1752660278" alt="icon"></span><span class="__label">Special Offers</span></a></li>
             
            </ul>
        </div>
       {% comment %}
         
       {% endcomment %}
       <div id="render-submenus"></div>
    </div>
  </div>
</submenu>
<script>
  window.menuData = {};
  {% assign menu_handles = block.settings.menu-item-1 | append: "," | append: block.settings.menu-item-2 | split: "," %}
  {% for menu_handle in menu_handles %}
    window.menuData["{{ menu_handle }}"] = {
      title: "{{ menu_handle }}",
      items: [
        {% assign main_menu = linklists[menu_handle] %}
        {% for top_link in main_menu.links %}
          {
            title: "{{ top_link.title | escape }}",
            url: "{{ top_link.url }}",
            children: [
              {% for child_link in top_link.links %}
                {
                  title: "{{ child_link.title | escape }}",
                  url: "{{ child_link.url }}",
                  children: [
                    {% for subchild_link in child_link.links %}
                      {
                        title: "{{ subchild_link.title | escape }}",
                        url: "{{ subchild_link.url }}"
                      }{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                  ]
                }{% unless forloop.last %},{% endunless %}
              {% endfor %}
            ]
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    };
  {% endfor %}
</script>


{% javascript %}
document.addEventListener('DOMContentLoaded', () => {
  const menus = window.menuData;

  function renderSubmenu(menu) {
    let html = `
      <div class="col-12 col-md-3 item item__2 w-300px level-2" menu-name="${menu.title}">
        <div class="item__1__group">
          <div class="submenu__heading heading__1">
            <h3 class="uppercase">${menu.title}</h3>
          </div>
          <ul class="submenu__items level-2">
    `;

    menu.items.forEach(top => {
     let additionalClass1 = ""
     if (top.children && top.children.length > 0) {
       additionalClass1 = "submenu-with-children"
     }
      html += `
        <li class="has-second-level style-2-li ${additionalClass1}">
          <a href="${top.url}">${top.title}</a>
      `;

      if (top.children && top.children.length > 0) {
        html += `
          <div class="submenu-items-container submenu-item__item style-2 level-3 w-300px">
            <div class="submenu__heading"><h3>${top.title}</h3></div>
            <ul class="submenu__items item">
        `;

        top.children.forEach(child => {
         let additionalClass = ""
         if (child.children && child.children.length > 0) {
           additionalClass = "submenu-with-children"
         }
          html += `<li class="has-third-level ${additionalClass}"><a href="${child.url}">${child.title}</a>`;

          if (child.children && child.children.length > 0) {
            html += `
              <ul class="submenu-subitems-inner item level-4 w-300px submenu-items-container submenu-item__item">
                <div class="submenu__heading"><h3>${child.title}</h3></div>
            `;
            child.children.forEach(sub => {
              html += `<li class="menu-item-last-child"><a href="${sub.url}">${sub.title}</a></li>`;
            });
            html += `</ul>`;
          }

          html += `</li>`;
        });

        html += `</ul></div>`;
      }

      html += `</li>`;
    });

    html += `</ul></div></div>`;
    return html;
  }

  let renderedHTML = '';
  Object.values(menus).forEach(menu => {
    renderedHTML += renderSubmenu(menu);
  });

  const renderContainer = document.getElementById('render-submenus');
  renderContainer.innerHTML = renderedHTML;

  // âœ… Show submenu on trigger li click
  const triggerItems = document.querySelectorAll(`[submenu-items]`);
  const allSubmenus = document.querySelectorAll('.item__2[menu-name]');

  triggerItems.forEach(trigger => {
    trigger.addEventListener('click', (e) => {
      e.preventDefault();

      const menuKey = trigger.getAttribute('submenu-items');

      // Hide all
      allSubmenus.forEach(sub => {
        sub.style.display = 'none';
      });

      // Show only the matched one
      const target = document.querySelector(`.item__2[menu-name="${menuKey}"]`);
      if (target) {
        target.style.display = 'block';
      }
    });
  });

  // Optional: Hide all by default
  allSubmenus.forEach(sub => sub.style.display = 'none');
  let submenuChildrens = document.querySelectorAll('.submenu-with-children');
  submenuChildrens.forEach((item)=>{
    item.addEventListener('click',function(e){
      e.preventDefault();
      clearSubmenuActive()
      let submenu = item.querySelector('.submenu-items-container');
      if (submenu) {
        submenu.style.display = 'block';
      }
    })
  })

  function clearSubmenuActive(){
      submenuChildrens.forEach((item)=>{
       let submenu = item.querySelector('.submenu-items-container');
       submenu.style.display = 'none';
      })
  }
});


{% endjavascript %}
<script>
  document.querySelectorAll('.has-second-level').forEach(item => {
    let timer;

    item.addEventListener('mouseenter', () => {
      clearTimeout(timer);
      const submenu = item.querySelector('.style-2');
      submenu && (submenu.style.display = 'block');
    });

    item.addEventListener('mouseleave', () => {
      const submenu = item.querySelector('.style-2');
      timer = setTimeout(() => {
        submenu && (submenu.style.display = 'none');
      }, 300); // delay in ms
    });
  });

  document.querySelectorAll('.has-third-level').forEach(item => {
    let timer;

    item.addEventListener('mouseenter', () => {
      clearTimeout(timer);
      const submenu = item.querySelector('.submenu-subitems-inner');
      submenu && (submenu.style.display = 'block');
    });

    item.addEventListener('mouseleave', () => {
      const submenu = item.querySelector('.submenu-subitems-inner');
      timer = setTimeout(() => {
        submenu && (submenu.style.display = 'none');
      }, 300);
    });
  });
</script>
